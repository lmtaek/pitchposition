<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Pitch Position Camera Feed</title>
    <style>
        #container {
            margin: 0px auto;
            width: 500px;
            height: 375px;
            border: 10px #333 solid
        }
        #videoElement {
            width: 500px;
            height: 375px;
            background-color: #666;
            -webkit-transform: scaleX(-1);
            transform: scaleX(-1);
        }
    </style>
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <!-- Load Posenet -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
</head>

<body>
    <div id="container">
        <video autoplay="true" id="videoElement"></video>
        <canvas  id="myCanvas" width="500" height="375"></canvas>
    </div>
</body>
<script>
  var video = document.querySelector("#videoElement");
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext('2d');

  function speak(){
    var msg = new SpeechSynthesisUtterance();
    var voices = window.speechSynthesis.getVoices();
    msg.voic = voices[10];
    msg.voiceURI = "native";
    msg.volume = 1;
    msg.rate = 1;
    msg.pitch = 0.8;
    msg.text = 'Please allow Pitch Position access to your camera.';
    speechSynthesis.speak(msg);
  }

  speak();

  if (navigator.mediaDevices.getUserMedia) {
    speak();
    navigator.mediaDevices.getUserMedia({video: true}).then(function (stream) {
      video.srcObject = stream;
      captureImage();
      calculatePose();
    })
    .catch(function (err0r) {
      console.log("Something went wrong.");
    });
  }

  function captureImage() {
    ctx.drawImage(video, 0, 0, canvas.Width, canvas.height);
  }

  var imageElement = document.getElementById("myCanvas");

  function calculatePose() {
    posenet.load().then(function(net) {
    const pose = net.estimateSinglePose(imageElement, {
      flipHorizontal: false
      });
    return pose;
  }).then(function(pose){
    console.log(pose);
    })
  }
    
  </script>
</html>